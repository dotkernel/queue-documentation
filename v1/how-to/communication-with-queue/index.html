<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="description" content="Dotkernel Queue">
        
        

        
        
            
        
        <meta name="docsearch:version" content="1.0.0,latest">
        <meta name="docsearch:language" content="en">
        <meta name="docsearch:component" content="queue">

        
        <link rel="canonical" href="https://docs.dotkernel.org/queue-documentation/v1/how-to/communication-with-queue/">
        
        <link rel="shortcut icon" href="https://docs.dotkernel.org/img/dk_docs_favicon_white.svg">

        <title>Communication With Queue - queue - Dotkernel Documentation</title>

        <link rel="stylesheet" href="https://docs.dotkernel.org/css/bootstrap.css">
        <link rel="stylesheet" href="https://docs.dotkernel.org/css/bootstrap-icons.min.css">
        <link rel="stylesheet" href="https://docs.dotkernel.org/css/docs.css">
        <script src="https://docs.dotkernel.org/js/bootstrap.js" defer></script>
        <script src="https://docs.dotkernel.org/js/docs.js" defer></script>
        <script src="https://docs.dotkernel.org/js/scripts.js" defer></script>
    </head>
    <body data-bs-spy="scroll" data-bs-target=".toc" data-bs-offset="100">

        
        <nav class="navbar navbar-expand-lg bg-body-tertiary bg-light dk-nav py-3" data-bs-theme="light">
    <div class="container justify-content-between">
        <div class="dk-nav-icon d-flex align-items-center">
            <a class="navbar-brand" href="https://docs.dotkernel.org/">
                <img alt="Dotkernel Logo" class="d-inline-block align-text-top" height="50"
                     src="https://docs.dotkernel.org//img/dk_logomark_white.svg" width="45"/>
            </a>

            <div class="dk-nav-icon-items">
                <span style="font-size: 12px; line-height: 13px">Dotkernel Documentation</span>

                <div class="dropdown" data-bs-theme="light">
                    <span class="fw-bold dropdown-toggle dk-pkg-name" data-bs-toggle="dropdown" aria-expanded="false">Queue</span>
                    <ul class="dropdown-menu">
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/api-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <i class="bi bi-arrow-return-right text-primary"></i>
                                <div class="py-1">
                                    <span class="fw-bold d-block">API</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/admin-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <i class="bi bi-arrow-return-right text-primary"></i>
                                <div class="py-1">
                                    <span class="fw-bold d-block">Admin</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/frontend-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <i class="bi bi-arrow-return-right text-primary"></i>
                                <div class="py-1">
                                    <span class="fw-bold d-block">Frontend</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/light-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <i class="bi bi-arrow-return-right text-primary"></i>
                                <div class="py-1">
                                    <span class="fw-bold d-block">Light</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item bg-dark-subtle">
                            <a href="https://docs.dotkernel.org/queue-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <i class="bi bi-arrow-return-right text-primary"></i>
                                <div class="py-1">
                                    <span class="fw-bold d-block">Queue</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/packages/" class="nav-link d-flex gap-4 align-items-center">
                                <i class="bi bi-arrow-return-right text-primary"></i>
                                <div class="py-1">
                                    <span class="fw-bold d-block">Packages</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/development/" class="nav-link d-flex gap-4 align-items-center">
                                <i class="bi bi-arrow-return-right text-primary"></i>
                                <div class="py-1">
                                    <span class="fw-bold d-block">Development</span>
                                </div>
                            </a>
                        </li>
                        
                        <li class="dropdown-item ">
                            <a href="https://docs.dotkernel.org/headless-documentation/" class="nav-link d-flex gap-4 align-items-center">
                                <i class="bi bi-arrow-return-right text-primary"></i>
                                <div class="py-1">
                                    <span class="fw-bold d-block">Headless Platform</span>
                                </div>
                            </a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarText">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
<!--                <li class="nav-item">-->
<!--                    <a href="#" class="nav-link fw-bold text-white" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal" title="Open search">-->
<!--                        <i class="bi bi-search"></i> Search-->
<!--                    </a>-->
<!--                </li>-->
                <li class="nav-item">
                    <a class="nav-link fw-bold text-white" href="https://github.com/dotkernel/queue" title="Go to queue repository" target="_blank">
                        <i class="bi bi-github"></i>
                        GitHub
                    </a>
                </li>
                <li class="nav-item">
                    
    

                </li>
            </ul>
        </div>
    </div>
</nav>

        
        <div class="container">
    <nav aria-label="breadcrumb" class="nav_breadcrumb">
        <ol class="breadcrumb">
            
                <li class="breadcrumb-item"><a href="https://docs.dotkernel.org/">Overview</a></li>
                

                
                    <li class="breadcrumb-item"><a href="../../..">queue</a></li>

                    
                        
                            
                            
                        
                    
                        
                            
                            
                                <li class="breadcrumb-item">How to</li>
                            
                        
                    

                    <li class="breadcrumb-item active" aria-current="page">Communication With Queue</li>
                
            
        </ol>
    </nav>
</div>

        
        <div class="container">
            <div class="row">
                <div class="col-lg-3 right_sidebar">
                    
                    
    <div class="subnavigation hidden-print">
<!--        <h4 class="subnavigation__title">-->
<!--            <a href="../../..">queue</a>-->
<!--        </h4>-->

        <h5 class="subnavigation__title">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                
                    
                        
<li class="subnavigation__list-item ">
    <a href="../../overview/" class="subnavigation__link">Overview</a>
</li>

                    
                        
<li class="subnavigation__list-item ">
    <a href="../../what-is-queue/" class="subnavigation__link">Understanding the Queue</a>
</li>

                    
                        
<li class="subnavigation__list-item ">
    <a href="../../server-setup/" class="subnavigation__link">Server Setup</a>
</li>

                    
                        
<li class="subnavigation__list-item ">
    <a href="../../installation/" class="subnavigation__link">Installation</a>
</li>

                    
                        
<li class="subnavigation__list-item ">
    <a href="../../messenger-configuration/" class="subnavigation__link">Messenger Configuration</a>
</li>

                    
                        
<li class="subnavigation__list-item ">
    <a href="../../control-commands/" class="subnavigation__link">Control Commands</a>
</li>

                    
                        
<li class="subnavigation__list-item ">
    <a href="../../valkey/" class="subnavigation__link">Valkey</a>
</li>

                    
                        















<li class="subnavigation__list-item">
    <a data-bs-toggle="collapse" href="#how-to" role="button" aria-expanded="false" aria-controls="how-to">
        <span class="subnavigation__headline">How to</span>
    </a>
    <ul class="subnavigation__list collapse" id="how-to">
        
        
<li class="subnavigation__list-item subnavigation__list-item--active">
    <a href="./" class="subnavigation__link">Communication With Queue</a>
</li>

        
        
<li class="subnavigation__list-item ">
    <a href="../send-emails/" class="subnavigation__link">Send Emails</a>
</li>

        
    </ul>
</li>

                    
                
            
        </ul>
    </div>

                    

                    
                    
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
            
                <li class="toc__entry">
                    <a href="#procedural-approach" class="toc__link nav-link">Procedural approach</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#object-oriented-approach" class="toc__link nav-link">Object-oriented approach</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#step-1-notificationsystem-module" class="toc__link nav-link">Step 1 NotificationSystem module</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#step-2-install-new-dependencies" class="toc__link nav-link">Step 2 Install new dependencies</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#step-3-configuration" class="toc__link nav-link">Step 3 Configuration</a>
                </li>
            
                <li class="toc__entry">
                    <a href="#step-4-service-usage" class="toc__link nav-link">Step 4 Service usage</a>
                </li>
            
            </ul>
        </div>
    

                    
                </div>
                <div class="col-lg-9 main_docs">
                    
                    




    
    
<!--        <h2 class="chapter__headline text-black-50">How to</h2>-->
    

    <h1 id="communicate-with-queue">COMMUNICATE WITH QUEUE</h1>
<p>Communication with the  <a href="https://github.com/dotkernel/queue"><code>Dotkernel Queue</code></a> can be achieved in two different ways: procedural and object-oriented.</p>
<h2 id="procedural-approach">Procedural approach</h2>
<p>The main advantage of the procedural code is its simplicity, it directly connects to the queue server, sends the prepared data, and then closes the connection. In this example, the code opens a TCP connection to <code>localhost:8556</code>, checks if the connection is successful, sends data in JSON format, and closes the socket. This makes the logic easy to follow and quick to implement. The disadvantage of this approach is the difficulty of reusing and extending the code. As the complexity of the project increases by repeatedly using this approach, the code becomes more difficult to maintain and not as flexible compared to the object-oriented approach.</p>
<pre class="highlight"><code class="language-php">// collect the PAYLOAD that will be sent to Dotkernel Queue 
$data = $anyTypeOfData;

// open TCP connection to Dotkernel Queue server
// replace localhost with the IP of the Dotkernel Queue server
// replace 8556 with the port number 
$client = stream_socket_client("tcp://localhost:8556", $errno, $errstr, 30);

if (! $client) {
    // log errors
    error_log("Connection error: $errstr ($errno)");
} else {
    // send the PAYLOAD to Dotkernel Queue 
    fwrite($client, json_encode($data) . "\n");
    // make sure your message ends with a new line
    // this allows the stream to know when the message is complete
    // without it, the server might keep waiting, and not process what was sent

    fclose($client);
    // close connection 
}</code></pre>
<h2 id="object-oriented-approach">Object-oriented approach</h2>
<p>Using object-oriented approach, queue is accessed through dedicated classes and objects. Instead of calling functions directly, you instantiate objects that encapsulate the behavior of the queue. This approach offers reusability, maintainability, and cleaner separation of responsibilities, which is especially beneficial in larger applications.</p>
<p>To implement this approach you need to follow a few simple steps:</p>
<h2 id="step-1-notificationsystem-module">Step 1 NotificationSystem module</h2>
<p>Create a new directory under the Core directory with the name NotificationSystem or any other name.</p>
<p>Inside it, create a new <code>ConfigProvider.php</code>, a new <code>NotificationService.php</code> and then copy the code below.</p>
<p>ConfigProvider code:</p>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Core\NotificationSystem;

use Core\NotificationSystem\Service\NotificationService;
use Dot\DependencyInjection\Factory\AttributedServiceFactory;

/**
 * @phpstan-type ConfigType array{
 *      dependencies: DependenciesType,
 * }
 * @phpstan-type DependenciesType array{
 *       factories: array&lt;class-string, class-string&gt;,
 * }
 */
class ConfigProvider
{
    /**
     * @return ConfigType
     */
    public function __invoke(): array
    {
        return [
            'dependencies' =&gt; $this-&gt;getDependencies(),
        ];
    }

    /**
     * @return DependenciesType
     */
    public function getDependencies(): array
    {
        return [
            'factories' =&gt; [
                NotificationService::class =&gt; AttributedServiceFactory::class,
            ],
        ];
    }
}</code></pre>
<p>Service code:</p>
<pre class="highlight"><code class="language-php">&lt;?php

declare(strict_types=1);

namespace Core\NotificationSystem\Service;

use Core\User\Entity\User;
use Dot\DependencyInjection\Attribute\Inject;
use Laminas\Json\Encoder;
use Socket\Raw\Factory;
use Socket\Raw\Socket;

class NotificationService
{
    #[Inject(
        'config.notification.server',
    )]
    public function __construct(
        // $config from local.php (see step 3)
        private readonly array $config
    ) {
    }

    // open TCP connection to Dotkernel Queue
    public function createClient(): Socket
    {
        $socketRawFactory = new Factory();
        return $socketRawFactory-&gt;createClient(
            $this-&gt;config['protocol'] . '://' . $this-&gt;config['host'] . ':' . $this-&gt;config['port']
        );
    }

    // send the PAYLOAD to Dotkernel Queue 
    public function send(string $message): void
    {
        $this-&gt;createClient()-&gt;write($message . $this-&gt;config['eof']);
    }

    // encode processed data
    protected function encodeEmailMessage(array $data): string
    {
        return Encoder::encode($data);
    }

    // process and send data
    // change $data type depending on what you need 
    public function sendNewAccountNotification(mixed $data): void
    {
        $data['yourKey'] = $data;
        $this-&gt;send($this-&gt;encodeEmailMessage($data));
    }

    //create your own custom methods to process data
}</code></pre>
<h2 id="step-2-install-new-dependencies">Step 2 Install new dependencies</h2>
<p>After you have finished creating the new files, navigate to composer.json and add the new dependencies under the require key:</p>
<pre class="highlight"><code class="language-json">{
  "require": {
    "ext-sockets": "*",
    "clue/socket-raw": "^1.6.0"
  }
}</code></pre>
<p>Install new dependencies using:</p>
<pre class="highlight"><code class="language-shell">composer install</code></pre>
<p>Under the <code>autoload</code> → <code>psr-4</code> key add the newly created module:</p>
<pre class="highlight"><code class="language-php">"Core\\NotificationSystem\\": "src/Core/src/NotificationSystem/src"</code></pre>
<p>Run <code>composer dump-autoload</code> to regenerate Composer’s autoload files.</p>
<h2 id="step-3-configuration">Step 3 Configuration</h2>
<p>Navigate to <code>config/config.php</code> and add your new Core ConfigProvider <code>Core\NotificationSystem\ConfigProvider::class</code>.</p>
<p>After you have added the new config provider, navigate to <code>config/autoload/local.php</code> and add a new config key used for server connection.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong>  if you only have the local.php.dist file, duplicate it, and delete .dist from the copy's name.</p>
</blockquote>
<pre class="highlight"><code class="language-php">'notification' =&gt; [
        'server' =&gt; [
            'protocol' =&gt; 'tcp',
            'host'     =&gt; 'IP of the Dotkernel Queue ',
            'port'     =&gt; 'port number',
            'eof'      =&gt; "\n",
        ],
    ],</code></pre>
<h2 id="step-4-service-usage">Step 4 Service usage</h2>
<p>Navigate to your handler, inject the new service and use your custom method where needed.</p>
<pre class="highlight"><code class="language-php">    #[Inject(
        NotificationService::class
    )]
    public function __construct(
        protected NotificationService $notificationService
    ) {</code></pre>




    <nav>
    <ul class="list-unstyled page-nav row w-100 mt-5 mb-3 pt-5 pb-3">
        
        <li class="col text-nowrap text-md-start">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../../valkey/">
                    <i class="bi bi-chevron-left"></i>
                    Valkey
                </a>
            
        </li>

        
        <li class="col text-nowrap text-md-end pe-0">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../send-emails/">
                    Send Emails
                    <i class="bi bi-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



                    
                </div>
            </div>
        </div>

        
        <footer class="footer">
    <div class="container">
        <hr class="mb-5" />

        <div class="row">
            <div class="col-md-9">
                <div class="row">
                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">API</p>

                        <a href="https://docs.dotkernel.org/api-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for building RESTful APIs
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Admin</p>

                        <a href="https://docs.dotkernel.org/admin-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for admin applications
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Frontend</p>

                        <a href="https://docs.dotkernel.org/frontend-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for frontend applications
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Light</p>

                        <a href="https://docs.dotkernel.org/light-documentation/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel web starter project suitable for generating a simple website
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Dotkernel Packages</p>

                        <a href="https://docs.dotkernel.org/packages/">
                            <i class="bi bi-arrow-return-right"></i>
                            Dotkernel packages offering a wide range of tools
                        </a>
                    </div>

                    <div class="col-lg-4 col-md-6 dk_widget">
                        <p class="ms-0">Development environment</p>

                        <a href="https://docs.dotkernel.org/development/">
                            <i class="bi bi-arrow-return-right"></i>
                            Install PHP, Apache, MariaDB, Composer, PhpMyAdmin, Node.js and Git on WSL2
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-3 pt-3 mt-1">
                <ul class="support__list row">
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://github.com/dotkernel" class="support__link" title="GitHub" target="_blank">
                            <i class="bi bi-github"></i> GitHub
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://dotkernel.slack.com" class="support__link" title="Chat" target="_blank">
                            <i class="bi bi-slack"></i> Slack
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://twitter.com/dotkernel" class="support__link" title="X (Twitter)" target="_blank">
                            <i class="bi bi-twitter-x"></i> Twitter
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://www.dotkernel.com/blog/" class="support__link" title="Blog" target="_blank">
                            <i class="bi bi-file-post"></i> Blog
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://www.dotkernel.com/feed/" class="support__link" title="Blog feed" target="_blank">
                            <i class="bi bi-rss-fill"></i> Feed
                        </a>
                    </li>
                    <li class="support__list-item col-lg-6 mb-md-3">
                        <a href="https://github.com/orgs/dotkernel/discussions" class="support__link" title="Blog feed" target="_blank">
                            <i class="bi bi-chat-left-text"></i> Discussions
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <hr class="mt-5" />

        <div class="footer_copy">
            &#169; Copyright Dotkernel <span id="current-year"></span>. All rights reserved.
        </div>
    </div>
</footer>

        <script>
            let base_url = '../../..',
                project  = "queue",
                siteName = 'queue';

                document.addEventListener("DOMContentLoaded", function() {
                    document.querySelectorAll('.subnavigation__link').forEach(function(link) {
                        if (link.getAttribute('href') === './') {
                            link.parentNode.parentNode.classList.add('show');
                        }
                    });
                });
        </script>
<!--        -->
<!--        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in queue" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>-->
    </body>
</html>
